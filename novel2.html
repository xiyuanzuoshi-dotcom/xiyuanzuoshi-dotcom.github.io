<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ¦ã‚¤ã¨ã®æœ€å¾Œã®ã²ã¨ã¨ã</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 0;
  background-color: #000;
  overflow: hidden;
}
#game-container { position: relative; width: 100%; height: 100vh; overflow: hidden; }
#background {
  position: absolute; inset: 0;
  background-size: cover;
  background-position: center;
  transition: background-image 0.5s ease-in-out;
  z-index: 0;
}
#character {
  position: absolute;
  bottom: 0; left: 50%;
  transform: translateX(-50%);
  width: 350px; height: 550px;
  background-size: contain;
  background-position: bottom center;
  background-repeat: no-repeat;
  z-index: 1;
}
#game-text {
  position: absolute;
  bottom: 220px; left: 50%;
  transform: translateX(-50%);
  color: white; font-size: 1.6em;
  width: 80%; text-align: center; line-height: 1.5em;
  padding: 15px 20px;
  background-color: rgba(0, 0, 0, 0.6);
  border-radius: 12px; z-index: 2;
}
#choices {
  position: absolute;
  bottom: 30px; left: 50%;
  transform: translateX(-50%);
  width: 80%; text-align: center;
  display: flex; flex-direction: column;
  gap: 15px; z-index: 2;
}
#action-buttons {
  position: absolute;
  top: 20px; right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 5;
}
button {
  font-size: 1.1em;
  padding: 15px 20px;
  border-radius: 10px;
  border: 2px solid #ccc;
  background-color: rgba(255, 255, 255, 0.8);
  color: #333;
  cursor: pointer;
  transition: all 0.3s ease;
}
button:hover { background-color: rgba(255, 255, 255, 1); }

#world-shift-effect {
  position: fixed; inset: 0; background: black; z-index: 10000;
  overflow: hidden; animation: pixelShift 1.5s ease forwards;
}
#world-shift-effect .scanline {
  position: absolute; inset: 0;
  background-image: repeating-linear-gradient(to bottom, rgba(255,255,255,0.05) 0px, rgba(0,0,0,0.1) 2px, transparent 4px);
  animation: scan 1s linear infinite;
}
#world-shift-effect .pixelate {
  position: absolute; inset: 0;
  background: repeating-linear-gradient(to right, rgba(255,255,255,0.05) 0px, rgba(0,0,0,0.05) 2px, transparent 4px);
  mix-blend-mode: overlay;
  animation: pixelFade 1.5s ease forwards;
}
@keyframes pixelShift {
  0% { opacity: 0; filter: none; }
  30% { opacity: 1; filter: contrast(200%) saturate(150%) hue-rotate(30deg); }
  70% { filter: blur(3px) contrast(300%) saturate(50%); }
  100% { opacity: 1; filter: blur(20px) brightness(0); }
}
@keyframes scan { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
@keyframes pixelFade { 0% { opacity: 0; } 100% { opacity: 1; } }
</style>
</head>
<body>
<div id="game-container">
  <div id="game-text"></div>
  <div id="choices"></div>
  <div id="action-buttons"></div>
  <div id="character"></div>
  <div id="background"></div>
</div>

<script>
const gameData = {
  scenes: {
    0: {
      texts: ["èŠ±äº• è‘‰ ï¼šä»Šæ—¥ã‚‚ãƒã‚¤ãƒˆç–²ã‚ŒãŸãªã€æ—©ãå¸°ã£ã¦å¯ã‚ˆã†", "èŠ±äº• è‘‰ ï¼šä»Šæ—¥ã¯äººé€šã‚Šã‚‚å°‘ãªã„ãªâ€¦â€¦"],
      next: 1,
      background: "scene_1.png"
    },
    1: {
      texts: ["èŠ±äº• è‘‰ ï¼šè²æ®»ã®ã‚ªãƒ«ã‚´ãƒ¼ãƒ«ã â€¦", "èŠ±äº• è‘‰ ï¼šã™ã”ãç¶ºéº—ã ãªã€ã©ã“ã‹ã§è¦‹ãŸæ°—ãŒã™ã‚‹ã‘ã©â€¦"],
      choices: [
        { text: "æŒã£ã¦å¸°ã‚‹", nextId: 3 },
        { text: "ãã®ã¾ã¾å¸°ã‚‹", nextId: 2 }
      ],
      background: "scene_1.png"
    },
    2: {
      texts: ["èŠ±äº• è‘‰ ï¼šæ˜æ—¥ã‚‚ã¾ãŸæœã‹ã‚‰ãƒã‚¤ãƒˆã ãªã‚â€¦"],
      background: "scene_1.png"
    },
    3: {
      texts: [
        "èŠ±äº• è‘‰ ï¼šæŒã£ã¦å¸°ã£ã¡ã‚ƒã£ãŸã‘ã©ã€æ˜æ—¥äº¤ç•ªã«æŒã£ã¦è¡Œã‹ãªãã‚ƒ",
        "èŠ±äº• è‘‰ ï¼šå¯ã‚‹å‰ã«ã‚‚ã†ä¸€åº¦èã„ã¦ã¿ã‚ˆã†ã‹ãª"
      ],
      choices: [
        { text: "äº¤ç•ªã¸æŒã£ã¦ã„ã", nextId: 4 },
        { text: "è‡ªåˆ†ã®ã‚‚ã®ã«ã™ã‚‹", nextId: 5 }
      ],
      background: "scene_2.png"
    },
    4: {
      texts: ["èŠ±äº• è‘‰ ï¼šäº¤ç•ªã«è¡Œã“ã†â€¦", "ãªã‚“ã ã‹èƒ¸ãŒã–ã‚ã¤ããªâ€¦"],
      next: 6,
      background: "scene_2.png",
      event: "goToAoHeya"
    },
    5: {
      texts: ["èŠ±äº• è‘‰ ï¼šè‰¯ã„éŸ³è‰²ã ãªã‚ã€ã©ã“ã‹ã§èã„ãŸã“ã¨ã‚ã‚‹ã‚ˆã†ãªâ€¦"],
      background: "scene_2.png",
      event: "goToHeya"
    },
    6: {
      texts: ["è­¦å¯Ÿå®˜ï¼šã‚ã‚ŠãŒã¨ã­ã€åå‰ã¯ï¼Ÿ"],
      background: "scene_3.png",
      event: "nameInput"
    },
    7: {
      texts: ["èŠ±äº• è‘‰ ï¼šè½ã¨ã—ä¸»ãŒè¦‹ã¤ã‹ã‚‹ã¨ã„ã„ãªâ€¦", "èŠ±äº• è‘‰ ï¼šã§ã‚‚ã€ã©ã“ã‹ã§è¦‹ãŸã“ã¨ãŒã‚ã‚‹ã‚“ã ã‘ã©ãªâ€¦"],
      background: "scene_3.png"
    },
    8: {
      texts: ["ãƒ¦ã‚¤ï¼šè—¤æ²¢ãã‚“ã€ã‚ã‚ŠãŒã¨ã†", "ãƒ¦ã‚¤ï¼šã‚‚ã†ä¸€åº¦ã€ä¼šãˆã‚‹ã¨æ€ã£ã¦ãŸ"],
      next: 9,
      background: "scene_4.png"
    },
    9: {
      texts: ["æ¬¡ä½œã¸ç¶šãï¼ï¼ï¼"],
      background: "scene_4.png"
    }
  }
};

let currentSceneId = 0;
let currentTextIndex = 0;
let playerName = "";

function renderScene() {
  const scene = gameData.scenes[currentSceneId];
  const textEl = document.getElementById("game-text");
  const choicesEl = document.getElementById("choices");
  const actionEl = document.getElementById("action-buttons");
  const bgEl = document.getElementById("background");

  textEl.textContent = scene.texts[currentTextIndex];
  bgEl.style.backgroundImage = `url(${scene.background})`;
  choicesEl.innerHTML = "";
  actionEl.innerHTML = "";

  // ğŸ”¹ ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ï¼ˆã¾ã ãƒ†ã‚­ã‚¹ãƒˆãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆï¼‰
  if (currentTextIndex < scene.texts.length - 1) {
    const nextBtn = document.createElement("button");
    nextBtn.textContent = "æ¬¡ã¸";
    nextBtn.onclick = () => {
      currentTextIndex++;
      renderScene();
    };
    choicesEl.appendChild(nextBtn);
    return;
  }

  // ğŸ”¹ ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
  if (scene.event) {
    if (scene.event === "nameInput") {
      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = "ã‚ãªãŸã®åå‰ã‚’å…¥åŠ›";
      input.style.padding = "10px";
      input.style.fontSize = "1.2em";
      input.style.borderRadius = "8px";
      input.style.border = "2px solid #ccc";
      input.style.textAlign = "center";
      input.style.width = "70%";
      input.style.marginBottom = "10px";

      const btn = document.createElement("button");
      btn.textContent = "OK";
      btn.onclick = () => {
        const name = input.value.trim();
        if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        playerName = name;
        currentSceneId = playerName === "ã‚†ã‚ã®ã‚ˆã†" ? 8 : 7;
        currentTextIndex = 0;
        renderScene();
      };
      choicesEl.append(input, btn);
      return;
    }

    // âœ… id4, id5 ã®å°‚ç”¨ãƒœã‚¿ãƒ³ã¯å³ä¸Šã«é…ç½®
    if (scene.event === "goToAoHeya") {
      const btn = document.createElement("button");
      btn.textContent = "äº¤ç•ªã¸å‘ã‹ã† â–¶";
      btn.onclick = () => transitionTo("aoheya.html");
      actionEl.appendChild(btn);
    }

    if (scene.event === "goToHeya") {
      const btn = document.createElement("button");
      btn.textContent = "éƒ¨å±‹ã¸æˆ»ã‚‹ â–¶";
      btn.onclick = () => transitionTo("heya.html");
      actionEl.appendChild(btn);
    }
  }

  // ğŸ”¹ é¸æŠè‚¢ãŒã‚ã‚‹å ´åˆ
  if (scene.choices) {
    scene.choices.forEach(c => {
      const btn = document.createElement("button");
      btn.textContent = c.text;
      btn.onclick = () => {
        currentSceneId = c.nextId;
        currentTextIndex = 0;
        renderScene();
      };
      choicesEl.appendChild(btn);
    });
    return;
  }

  // ğŸ”¹ è‡ªå‹•é·ç§»
  if (scene.next !== undefined) {
    const btn = document.createElement("button");
    btn.textContent = "æ¬¡ã¸";
    btn.onclick = () => {
      currentSceneId = scene.next;
      currentTextIndex = 0;
      renderScene();
    };
    choicesEl.appendChild(btn);
    return;
  }

  // ğŸ”¹ çµ‚äº†
  const endText = document.createElement("div");
  endText.textContent = "ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§æœ€åˆã«æˆ»ã‚‹ï¼‰";
  endText.style.color = "#ccc";
  choicesEl.appendChild(endText);
  textEl.onclick = () => {
    currentSceneId = 0;
    currentTextIndex = 0;
    renderScene();
  };
}

// ğŸ”¸ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä»˜ãã‚·ãƒ¼ãƒ³é·ç§»
function transitionTo(target) {
  const effect = document.createElement("div");
  effect.id = "world-shift-effect";
  effect.innerHTML = `<div class="scanline"></div><div class="pixelate"></div>`;
  document.body.appendChild(effect);
  setTimeout(() => (window.location.href = target), 1500);
}

renderScene();
</script>
</body>
</html>
