<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Wheelie Run - Real 3D Bike Edition</title>
<style>
  html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#000;}
  #container{width:100%;height:100%;display:block;position:relative;}
  .loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-family:sans-serif;}
</style>
</head>
<body>
<div id="container">
  <div class="loading" id="loading">üèçÔ∏è „Éê„Ç§„ÇØË™≠Ëæº‰∏≠...</div>
</div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, bike, trackCurve, controls;
let clock = new THREE.Clock();
let posZ = 0, speed = 8;
let isModelLoaded = false;

init();
animate();

function init(){
  scene = new THREE.Scene();
  scene.fog = new THREE.Fog(0x000000, 10, 1500);

  // === „Ç´„É°„É© ===
  camera = new THREE.PerspectiveCamera(65, innerWidth/innerHeight, 0.1, 2000);
  camera.position.set(0, 5, -10);
  camera.lookAt(0,0,10);

  // === „É¨„É≥„ÉÄ„É©„Éº ===
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth, innerHeight);
  renderer.setClearColor(0x050505);
  document.getElementById('container').appendChild(renderer.domElement);

  // === Áí∞Â¢ÉÂÖâ„ÉªÊñπÂêëÂÖâ ===
  const hemi = new THREE.HemisphereLight(0xffffff, 0x202020, 1.3);
  const dir = new THREE.DirectionalLight(0xffffff, 0.9);
  dir.position.set(20,50,20);
  scene.add(hemi, dir);

  // === „Ç≥„Éº„Çπ ===
  trackCurve = new THREE.CatmullRomCurve3([
    new THREE.Vector3(0,0,0),
    new THREE.Vector3(8,0,200),
    new THREE.Vector3(-8,0,400),
    new THREE.Vector3(6,0,600),
    new THREE.Vector3(0,0,800),
    new THREE.Vector3(5,0,1000)
  ]);

  const roadGeo = new THREE.TubeGeometry(trackCurve, 300, 5, 32, false);
  const roadMat = new THREE.MeshStandardMaterial({
    color: 0x444444, metalness: 0.6, roughness: 0.3, side: THREE.DoubleSide
  });
  const road = new THREE.Mesh(roadGeo, roadMat);
  scene.add(road);

  // === „Çµ„Ç§„Éâ„É©„Ç§„É≥ ===
  const lineMat = new THREE.MeshBasicMaterial({color:0xffffff});
  const lineGeo1 = new THREE.TubeGeometry(trackCurve, 300, 0.08, 8, false);
  const lineGeo2 = new THREE.TubeGeometry(trackCurve, 300, 0.08, 8, false);
  const line1 = new THREE.Mesh(lineGeo1, lineMat);
  const line2 = new THREE.Mesh(lineGeo2, lineMat);
  line1.scale.set(1.12,1.12,1.12);
  line2.scale.set(0.88,0.88,0.88);
  scene.add(line1,line2);

  // === ÊòüÂ±ëËÉåÊôØ ===
  const stars = new THREE.Group();
  for(let i=0;i<1000;i++){
    const s = new THREE.Mesh(new THREE.SphereGeometry(0.5,8,8),
      new THREE.MeshBasicMaterial({color:0xffffff}));
    s.position.set((Math.random()-0.5)*2000, Math.random()*600+100, (Math.random()-0.5)*2000);
    stars.add(s);
  }
  scene.add(stars);

  // === GLTF „Éê„Ç§„ÇØ„É¢„Éá„É´Ë™≠„ÅøËæº„Åø ===
  const loader = new THREE.GLTFLoader();
  // ËªΩÈáè„ÅßÊ±éÁî®ÁöÑ„Å™„Éï„É™„Éº„Éê„Ç§„ÇØ„É¢„Éá„É´(GLTF)
  loader.load(
    "https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Motorcycle/glTF-Binary/Motorcycle.glb",
    (gltf)=>{
      bike = gltf.scene;
      bike.scale.set(0.05,0.05,0.05);
      bike.position.set(0,1,0);
      bike.rotation.y = Math.PI; // Âêë„Åç„ÇíÂâç„Å´
      scene.add(bike);
      isModelLoaded = true;
      document.getElementById("loading").style.display = "none";
    },
    (xhr)=>{
      document.getElementById("loading").textContent = `Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶ ${(xhr.loaded/xhr.total*100).toFixed(0)}%`;
    },
    (error)=>{
      console.error("„É¢„Éá„É´Ë™≠Ëæº„Ç®„É©„Éº:", error);
      document.getElementById("loading").textContent = "‚ùå „Éê„Ç§„ÇØË™≠ËæºÂ§±Êïó";
    }
  );

  // === „Ç≥„É≥„Éà„É≠„Éº„É´ÔºàÁ¢∫Ë™çÁî®Ôºâ ===
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.enablePan = false;

  // === „É™„Çµ„Ç§„Ç∫ ===
  window.addEventListener("resize", ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });
}

function animate(){
  requestAnimationFrame(animate);
  const dt = clock.getDelta();

  if(isModelLoaded){
    posZ += speed * dt * 10;
    const t = (posZ % 1000) / 1000;
    const point = trackCurve.getPointAt(t);
    const tangent = trackCurve.getTangentAt(t);

    bike.position.copy(point);
    bike.position.y += 0.8;
    bike.lookAt(point.clone().add(tangent));

    // „Ç´„É°„É©ËøΩÂæì
    const camOffset = tangent.clone().multiplyScalar(-12).add(new THREE.Vector3(0,5,0));
    camera.position.copy(point.clone().add(camOffset));
    camera.lookAt(point.clone().add(tangent));
  }

  controls.update();
  renderer.render(scene, camera);
}
</script>
</body>
</html>
